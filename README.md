# Foodgram - Продуктовый помощник

Веб-приложение для создания и управления рецептами. Пользователи могут публиковать свои рецепты, добавлять понравившиеся рецепты в избранное, подписываться на авторов и формировать список покупок для выбранных блюд.

Для полного доступа к функциям сайта необходимо зарегистрироваться. Подтверждение email не требуется.

---

## Возможности проекта

**Для пользователей:**
- Просмотр рецептов с пагинацией (сортировка по дате публикации)
- Регистрация и авторизация по email и паролю
- Управление аватаром профиля
- Создание, редактирование и удаление собственных рецептов
- Добавление рецептов в избранное
- Подписки на авторов рецептов
- Добавление рецептов в список покупок
- **Скачивание списка покупок** в текстовом формате с автоматическим суммированием ингредиентов
- Получение коротких ссылок на рецепты

**Технические особенности:**
- REST API строго по спецификации
- Token-based аутентификация через djoser
- Админ-панель с поиском и фильтрацией
- Поддержка изображений в формате Base64
- Фильтрация рецептов по автору, избранному, списку покупок

---

## Стек технологий

- **Backend:** Python 3.12, Django 3.2.16, Django REST Framework 3.12.4
- **Database:** PostgreSQL 13.10 (SQLite для разработки)
- **Authentication:** Token-based authentication (djoser 2.1.0)
- **Frontend:** React SPA (готовое приложение)
- **Infrastructure:** Docker, Docker Compose, Nginx 1.25.4
- **Additional:** Pillow (изображения), python-dotenv, drf-extra-fields

---

## Быстрый старт

### Предварительные требования
- Docker и Docker Compose
- Git

### Установка

1. **Клонирование репозитория**
```bash
git clone <repository-url>
cd foodgram-st
```

2. **Настройка окружения**

Создайте файл `.env` в папке `infra/` с содержимым:
```bash
POSTGRES_USER=django_user
POSTGRES_PASSWORD=your_password
POSTGRES_DB=django_foodgram
SECRET_KEY=django-insecure-m8k@9x#v$2w+e!r7y&q3n*z6s4f^h9j2p5t8u1b3c6d9g2k5
DB_HOST=db
DB_PORT=5432
```

3. **Запуск проекта**
```bash
cd infra
docker-compose up --build -d
```

4. **Инициализация данных**
```bash
# Выполните миграции (создание таблиц БД)
docker-compose exec backend python manage.py migrate

# Загрузите ингредиенты из подготовленного списка
docker-compose exec backend python manage.py load_ingredients

# Соберите статические файлы для админки
docker-compose exec backend python manage.py collectstatic --no-input
```

5. **Создание суперпользователя (для доступа в админку)**
```bash
docker-compose exec backend python manage.py createsuperuser
```

**Важно:** Все команды выполняются в папке `infra/`. Сборка контейнеров может занять несколько минут.

### Доступ к приложению

- **Главная страница:** http://localhost (или http://127.0.0.1)
- **API документация:** http://localhost/api/docs/ (интерактивная спецификация)
- **Админ-панель:** http://localhost/admin/ (управление данными)

### Особенности работы приложения

**Список покупок:**
- Ингредиенты автоматически суммируются (например: мука 100г + мука 200г = мука 300г)
- Файл скачивается в формате `.txt` с полным списком продуктов
- Включает информацию о рецептах, для которых нужны ингредиенты

**Права доступа:**
- **Гости:** просмотр рецептов, регистрация, авторизация
- **Авторизованные:** создание рецептов, подписки, избранное, список покупок
- **Авторы:** редактирование и удаление только своих рецептов
- **Админ:** полный доступ через админ-панель

**Админ-панель включает:**
- Поиск пользователей по email и имени
- Поиск рецептов по названию и автору
- Поиск ингредиентов по названию
- Счетчик добавлений рецепта в избранное

---

## Использование API

Документация доступна по адресу `/api/docs/` после запуска проекта.

### Основные эндпоинты:
- `GET /api/recipes/` - список рецептов
- `POST /api/recipes/` - создание рецепта
- `GET /api/ingredients/` - список ингредиентов
- `POST /api/users/` - регистрация
- `POST /api/auth/token/login/` - получение токена

### Аутентификация
```bash
# Получение токена
curl -X POST http://localhost/api/auth/token/login/ \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com", "password": "password"}'

# Использование токена
curl -H "Authorization: Token YOUR_TOKEN" \
  http://localhost/api/recipes/
```

---

## Архитектура проекта

### Модели данных
- **User** - кастомная модель пользователя с аватаром
- **Recipe** - рецепты с изображениями и временем приготовления
- **Ingredient** - ингредиенты с единицами измерения
- **IngredientInRecipe** - связь рецептов и ингредиентов с количеством
- **Subscription** - подписки пользователей на авторов
- **Favorite** - избранные рецепты пользователей
- **ShoppingCart** - список покупок пользователей

### Инфраструктура
Проект запускается в 4 контейнерах:
- **db** - PostgreSQL база данных
- **backend** - Django приложение с Gunicorn
- **frontend** - временный контейнер для сборки React файлов
- **nginx** - веб-сервер и reverse proxy

Данные сохраняются в Docker volumes, статика и медиа файлы проксируются через Nginx.

## Разработка

### Структура проекта
```
foodgram-st/
├── backend/          # Django REST API
│   ├── api/         # API приложение (views, serializers)
│   ├── recipes/     # Основные модели и админка
│   └── foodgram/    # Настройки Django
├── frontend/         # React SPA (готовое приложение)
├── infra/           # Docker конфигурация
│   ├── docker-compose.yml
│   ├── nginx.conf
│   └── .env
├── data/            # Тестовые данные (ингредиенты, рецепты)
└── docs/            # OpenAPI документация
```

### Соответствие техническому заданию
✅ Проект работает полностью  
✅ Рецепты сортируются по дате (новые выше)  
✅ Работает пагинация  
✅ Ингредиенты в списке покупок суммируются  
✅ PostgreSQL в продакшене  
✅ 4 контейнера: nginx, PostgreSQL, backend, frontend  
✅ Данные в volumes  
✅ Админка с поиском настроена  
✅ Код соответствует PEP 8

### Полезные команды
```bash
# Логи контейнеров
docker-compose logs backend

# Подключение к контейнеру  
docker-compose exec backend bash

# Остановка проекта
docker-compose down

# Перезапуск с пересборкой
docker-compose up --build -d

# Очистка volumes (удаление данных БД)
docker-compose down -v
```